<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="GF.L">
  
  
  
  <link rel="prev" href="https://keep-zero.github.io/2019/spring_action09/" />
  <link rel="next" href="https://keep-zero.github.io/2019/spring_action11_01/" />
  <link rel="canonical" href="https://keep-zero.github.io/2019/spring_action10/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           《Spring实战》-第十章:Spring和JDBC | Keep Zero
       
  </title>
  <meta name="title" content="《Spring实战》-第十章:Spring和JDBC | Keep Zero">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/keep-zero.github.io"
    },
    "articleSection" : "posts",
    "name" : "《Spring实战》-第十章:Spring和JDBC",
    "headline" : "《Spring实战》-第十章:Spring和JDBC",
    "description" : "慢慢来比较快，虚心学技术\n数据访问操作：初始化数据访问框架、打开连接、处理各种异常和关闭连接，任何一步出现异常都有可能导致损坏或删除企业数据库珍贵数据\n 详细文章请移步：CSDN-《Spring实战》-第十章:Spring和JDBC\n一、Spring 的数据访问哲学 ①松耦合 为了避免持久化的逻辑分散到应用的各个组件中，最好将数据访问的功能放到一个或多个专注于此项任务的组件中。这样的组件通常称为数据访问对象（ data access object ， DAO ）或 Repositor\n为了避免应用与特定的数据访问策略耦合在一起，编写良好的 Repository 应该以接口的方式暴露功能。图 10.1 展现了设计数据访问层的合理方式\n接口是实现松耦合代码的关键，并且应将其用于应用程序的各个层，而不仅仅是持久化层\n②Spring 数据访问异常 JDBC对于所有的数据访问问题都会抛出 SQLException ，可能导致抛出 SQLException 的常见问题包括：\n 应用程序无法连接数据库 要执行的查询存在语法错误； 查询中所使用的表和 \/ 或列不存在； 试图插入或更新的数据违反了数据库约束  可见JDBC对于数据访问异常的处理十分粗糙，他并不会告诉你具体问题出现在哪里，而是讲所有问题都指向SQLException。所以很多持久化框架如Hibernate等都会提供自身的数据访问异常类，以供使用。但是如果我们在应用层次中引入了持久化框架的异常，很显然会紧紧的耦合在一起，违反了松耦合的约定。故而，Spring提供了自身一系列的异常类。\n然而，Spring所提供的异常都是继承自非检查型异常，所以并不需要强制开发人员必须catch。\n二、Spring 数据访问模板化 模板方法模式（设计模式）：模板方法定义过程的主要框架，模板方法将过程中与特定实现相关的部分委托给接口，而这个接口的不同实现定义了过程中的具体行为\nSpring将数据访问分为可变（模板）和不可变（固定）两部分：模板（ template ）和回调（ callback ）\n* Spring 的模板类处理数据访问的固定部分 —— 事务控制、管理资源以及处理异常。 * 应用程序相关的数据访问 —— 语句、绑定参数以及整理结果集 —— 在回调的实现中处理。\n模板：Spring为了兼容多个持久化框架，提供了一系列的模板类\njca.cci.core.CciTemplate====JCA CCI 连接\njdbc.core.JdbcTemplate====JDBC 连接\njdbc.core.namedparam.NamedParameterJdbcTemplate====支持命名参数的 JDBC 连接 jdbc.core.simple.SimpleJdbcTemplate====通过 Java 5 简化后的 JDBC 连接（ Spring 3.",
    "inLanguage" : "en-us",
    "author" : "GF.L",
    "creator" : "GF.L",
    "publisher": "GF.L",
    "accountablePerson" : "GF.L",
    "copyrightHolder" : "GF.L",
    "copyrightYear" : "2019",
    "datePublished": "2019-09-01 11:51:57 \x2b0800 CST",
    "dateModified" : "2019-09-01 11:51:57 \x2b0800 CST",
    "url" : "https:\/\/keep-zero.github.io\/2019\/spring_action10\/",
    "wordCount" : "1557",
    "keywords" : [ "java","spring","spring-action", "Keep Zero"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://keep-zero.github.io">Keep Zero</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://keep-zero.github.io">Keep Zero</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">《Spring实战》-第十章:Spring和JDBC</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://keep-zero.github.io" rel="author">GF.L</a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-09-01 itemprop="datePublished">September 1, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://keep-zero.github.io/categories/spring/"> spring </a>
                        
                </span>
				
				<span id="wc" style="font-size: 1rem;text-align: center;">  共1600 字|  阅读需时约 8 分|  本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<blockquote>
<p><strong>慢慢来比较快，虚心学技术</strong></p>

<p>数据访问操作：初始化数据访问框架、打开连接、处理各种异常和关闭连接，任何一步出现异常都有可能导致损坏或删除企业数据库珍贵数据</p>
</blockquote>

<p>详细文章请移步：<a href="https://blog.csdn.net/Laiguanfu/article/details/88832458" rel="nofollow noreferrer" target="_blank">CSDN-《Spring实战》-第十章:Spring和JDBC</a></p>

<h2 id="一-spring-的数据访问哲学">一、Spring 的数据访问哲学</h2>

<h3 id="①松耦合">①松耦合</h3>

<p>为了避免持久化的逻辑分散到应用的各个组件中，最好将数据访问的功能放到一个或多个专注于此项任务的组件中。这样的组件通常称为<strong>数据访问对象（ data access object ， DAO ）</strong>或 <strong>Repositor</strong></p>

<p>为了<strong>避免应用与特定的数据访问策略耦合在一起</strong>，编写良好的 Repository 应该以接口的方式暴露功能。图 10.1 展现了设计数据访问层的合理方式</p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/post_resource/spring-action/spring_action_10_01.jpg" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<p><strong>接口是实现松耦合代码的关键，并且应将其用于应用程序的各个层，而不仅仅是持久化层</strong></p>

<h3 id="②spring-数据访问异常"><strong>②Spring</strong> <strong>数据访问异常</strong></h3>

<p><strong>JDBC</strong>对于所有的数据访问问题都会抛出 SQLException ，可能导致抛出 SQLException 的常见问题包括：</p>

<ul>
<li>应用程序<strong>无法连接数据库</strong></li>
<li>要执行的查询存在<strong>语法错误</strong>；</li>
<li>查询中所使用的<strong>表和 / 或列不存在</strong>；</li>
<li>试图插入或更新的数据<strong>违反了数据库约束</strong></li>
</ul>

<p>可见JDBC对于数据访问异常的处理十分粗糙，他并不会告诉你具体问题出现在哪里，而是讲所有问题都指向SQLException。所以很多持久化框架如Hibernate等都会提供自身的数据访问异常类，以供使用。但是如果我们在应用层次中引入了持久化框架的异常，很显然会紧紧的耦合在一起，违反了松耦合的约定。故而，Spring提供了自身一系列的异常类。</p>

<p>然而，Spring所提供的异常都是<strong>继承自非检查型异常</strong>，所以并不需要强制开发人员必须catch。</p>

<h2 id="二-spring-数据访问模板化"><strong>二、Spring 数据访问模板化</strong></h2>

<p>模板方法模式（设计模式）：<strong>模板方法定义过程的主要框架，模板方法将过程中与特定实现相关的部分委托给接口，而这个接口的不同实现定义了过程中的具体行为</strong></p>

<p>Spring将数据访问分为可变（模板）和不可变（固定）两部分：<strong>模板（ template ）</strong>和<strong>回调（ callback ）</strong></p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/post_resource/spring-action/spring_action_10_02.jpg" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
*   Spring 的模板类处理数据访问的固定部分 —— 事务控制、管理资源以及处理异常。
*   应用程序相关的数据访问 —— 语句、绑定参数以及整理结果集 —— 在回调的实现中处理。</p>

<p>模板：Spring为了兼容多个持久化框架，提供了一系列的模板类</p>

<p><strong>jca.cci.core.CciTemplate</strong>====JCA CCI 连接</p>

<p><strong>jdbc.core.JdbcTemplate</strong>====JDBC 连接</p>

<p><strong>jdbc.core.namedparam.NamedParameterJdbcTemplate</strong>====支持命名参数的 JDBC 连接
<strong>jdbc.core.simple.SimpleJdbcTemplate</strong>====通过 Java 5 简化后的 JDBC 连接（ Spring 3.1 中已经废弃）
<strong>orm.hibernate3.HibernateTemplate</strong>====Hibernate 3.x 以上的 Session
<strong>orm.ibatis.SqlMapClientTemplate</strong>====iBATIS SqlMap 客户端
<strong>orm.jdo.JdoTemplate</strong>====Java 数据对象（ Java Data Object ）实现
<strong>orm.jpa.JpaTemplate</strong>====Java 持久化 API 的实体管理器</p>

<h2 id="三-spring-jdbc">三、Spring+JDBC</h2>

<h3 id="ⅰ-配置数据源">Ⅰ、配置数据源</h3>

<p>Spring配置数据源依赖的第三方框架都提供了基本的DataSource接口。</p>

<p>使用数据库连接池：</p>

<ul>
<li><strong>Apache Commons DBCP</strong></li>
<li><strong>c3p0</strong></li>
<li><strong>BoneCP</strong></li>
<li><strong>Druid</strong></li>
</ul>

<p><strong>DBCP连接池</strong></p>

<p>DBCP是 apache 上的一个 java 连接池项目，也是 tomcat 使用的连接池组件。</p>

<p>依赖于BasicDataSource对象实现数据源配置</p>

<p>BasicDataSource部分属性如下：
<strong>driverClassName</strong>：<strong>数据库连接驱动名，如：com.mysql.jdbc.Driver</strong>
<strong>url</strong>：<strong>数据库连接地址，如:jdbc:mysql://localshot:3306/数据库名</strong>
<strong>username</strong>：<strong>数据库连接用户名</strong>
<strong>passowrd</strong>：<strong>数据库连接密码</strong></p>

<p>首先引入依赖包：commons-dbcp.jar和commons-pool.jar</p>

<pre><code class="language-xml"> &lt;!-- https://mvnrepository.com/artifact/commons-dbcp/commons-dbcp --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;commons-dbcp&lt;/groupId&gt;
        &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt;
        &lt;version&gt;1.4&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- https://mvnrepository.com/artifact/commons-pool/commons-pool --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;commons-pool&lt;/groupId&gt;
        &lt;artifactId&gt;commons-pool&lt;/artifactId&gt;
        &lt;version&gt;1.4&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--引入Spring-jdbc的支持--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
        &lt;version&gt;${org.springframework.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--引入mysql数据连接驱动--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>

<p>两种方式配置DBCP连接池：</p>

<ul>
<li><strong>使用注解配置实现</strong></li>
</ul>

<p>①创建数据源配置类，定义数据源与JdbcTemplate操作模板</p>

<pre><code class="language-java">@Configuration
public class DataSourceConfig {
    /**
     * 数据源连接池
     */
    @Bean
    public DataSource dataSource(){
        BasicDataSource basicDataSource = new BasicDataSource();
        //设置驱动
        basicDataSource.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);
        //设置数据库路径
        basicDataSource.setUrl(&quot;jdbc:mysql://localhost:3306/spring&quot;);
        //设置数据库登录名
        basicDataSource.setUsername(&quot;spring&quot;);
        //设置数据库登录密码
        basicDataSource.setPassword(&quot;spring&quot;);
        //是否自动提交事务（默认为true）
        basicDataSource.setDefaultAutoCommit(true);
        return basicDataSource;
    }

    /**
     * Spring JdbcTemplate
     */
    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
</code></pre>

<p>②创建统一配置类，开启组件扫描，并将数据源配置类引入</p>

<pre><code class="language-java">@ComponentScan(basePackages = {&quot;com.my.spring&quot;})
@Configuration
@Import(DataSourceConfig.class)
public class SystemConfig {
}
</code></pre>

<p>③创建数据库操作的Object对象和相应的Dao和Service类</p>

<pre><code class="language-java">//BaseBean.java
@Data
public class BaseBean {

    private Integer id;

    private String name;

    private Integer age;
}

//BaseDaoParent.java,系统内所有Dao的父类，继承自JdbcDaoSupport
@Component
public class BaseDaoParent extends JdbcDaoSupport {

    //注入DataSource
    @Autowired
    private DataSource dataSource;

    //因为JdbcDaoSupport的setDataSource方法是final修饰的，@Autowired注入失败，所以必须手动注入
    @PostConstruct
    private void initialize(){
        setDataSource(dataSource);
    }
}

//BaseDao.java
@Repository
public class BaseDao extends BaseDaoParent{

    /**
     * 保存一个记录
     * @param baseBean
     */
    public void save(BaseBean baseBean){
        this.getJdbcTemplate().update(&quot;insert into basebean(name,age) values ('&quot;+baseBean.getName()+&quot;',&quot;+baseBean.getAge()+&quot;)&quot;);
    }

    /**
     * 获取所有bean记录
     * @return
     */
    public List&lt;BaseBean&gt; findAll(){
        RowMapper&lt;BaseBean&gt; rowMapper = new BeanPropertyRowMapper&lt;&gt;(BaseBean.class);
        return this.getJdbcTemplate().query(&quot;select * from basebean&quot;,rowMapper);
    }
}

//BaseService.java
public interface BaseService{
     /**
     * 保存一个记录
     * @param baseBean
     */
    void save(BaseBean baseBean);

    /**
     * 获取所有bean记录
     * @return
     */
    List&lt;BaseBean&gt; findAll();
}

//BaseServiceImpl.java
@Component
public class BaseServiceImpl implements BaseService {

    @Autowired
    private BaseDao baseDao;

    @Override
    public void save(BaseBean baseBean) {
        this.baseDao.save(baseBean);
    }

    @Override
    public List&lt;BaseBean&gt; findAll() {
        return this.baseDao.findAll();
    }
}
</code></pre>

<p>④编写测试类</p>

<pre><code class="language-java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = {SystemConfig.class})
public class DataSourceTest {

    @Autowired
    private BaseService baseService;

    /**
     *调用service方法存入对象
    */
    @Test
    public void testSaveBean(){
        BaseBean baseBean = new BaseBean();
        baseBean.setName(&quot;test&quot;);
        baseBean.setAge(15);
        this.baseService.save(baseBean);
    }

    /**
     *调用service方法获取所有记录
    */
   @Test
    public void testFindAll(){
        List&lt;BaseBean&gt; list = this.baseService.findAll();
        System.out.println(list.toString());
    }
}
</code></pre>

<p>⑤创建数据库表</p>

<pre><code class="language-sql">SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for basebean
-- ----------------------------
DROP TABLE IF EXISTS `basebean`;
CREATE TABLE `basebean`  (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `age` int(10) NULL DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 4 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;

SET FOREIGN_KEY_CHECKS = 1;

</code></pre>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/post_resource/spring-action/spring_action_10_03.jpg" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<p>⑥测试结果</p>

<p>调用存入BaseBean，同时获取列表：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15)]
</code></pre>

<ul>
<li><strong>使用xml配置实现</strong></li>
</ul>

<p>创建<strong>datasource.properties</strong>文件</p>

<pre><code class="language-properties">#指定数据库驱动
jdbc.driver = com.mysql.jdbc.Driver

#指定数据库url
jdbc.url = jdbc:mysql://localhost:3306/spring

#指定数据库用户
jdbc.username = spring

#指定数据库用户密码
jdbc.password = spring
</code></pre>

<p>创建application.xml</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 导入数据库资源文件 --&gt;
    &lt;context:property-placeholder location=&quot;classpath:datasource.properties&quot;/&gt;
    &lt;!--配置数据源--&gt;
    &lt;bean class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; id=&quot;dataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置注入数据源--&gt;
    &lt;bean id = &quot;baseDaoParent&quot; class=&quot;com.my.spring.dao.BaseDaoParent&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;baseDao&quot; class=&quot;com.my.spring.dao.BaseDao&quot; parent=&quot;baseDaoParent&quot;&gt;&lt;/bean&gt;

    &lt;bean id=&quot;baseService&quot; class=&quot;com.my.spring.service.impl.BaseServiceImpl&quot;&gt;
        &lt;property name=&quot;baseDao&quot; ref=&quot;baseDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<p>关闭组件扫描，同时在全局配置中引入application.xml</p>

<pre><code class="language-java">@Configuration
//@Import(DataSourceConfig.class)
@ImportResource(value = {&quot;classpath:application.xml&quot;})
public class SystemConfig {}
</code></pre>

<p>测试结果：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15)]
</code></pre>

<p><strong>C3P0连接池</strong></p>

<p>C3P0是一个开源的JDBC<a href="https://baike.baidu.com/item/%E8%BF%9E%E6%8E%A5%E6%B1%A0/1699713" rel="nofollow noreferrer" target="_blank">连接池</a>，它实现了数据源和JNDI绑定，支持JDBC3规范和JDBC2的标准扩展。目前使用它的<a href="https://baike.baidu.com/item/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/3406069" rel="nofollow noreferrer" target="_blank">开源项目</a>有Hibernate，Spring等。</p>

<p>依赖于<strong>ComboPooledDataSource</strong> 对象实现配置，其基本属性如下：
<strong>driverclass</strong>：<strong>数据库驱动类，比如MySQL为“com.mysql.jdbc.Driver”</strong>
<strong>jdbcUrl</strong>：<strong>数据库连接</strong>
<strong>user</strong>：<strong>登录数据库的账号</strong>
<strong>password</strong>：<strong>登录数据库的密码</strong></p>

<p><strong>使用注解方式配置C3P0</strong></p>

<p>①引入jar包：</p>

<pre><code class="language-xml">&lt;!--引入c3p0支持--&gt;
&lt;!-- https://mvnrepository.com/artifact/c3p0/c3p0 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;c3p0&lt;/groupId&gt;
    &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
    &lt;version&gt;0.9.1.2&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;${org.springframework.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<p>②创建数据源配置类，定义数据源与JdbcTemplate操作模板</p>

<pre><code class="language-java">@Configuration
@PropertySource(value = {&quot;classpath:datasource.properties&quot;})//引入资源文件
public class DataSourceConfig {

    @Value(&quot;${jdbc.driver}&quot;)
    private String driver;

    @Value(&quot;${jdbc.url}&quot;)
    private String url;

    @Value(&quot;${jdbc.username}&quot;)
    private String userName;

    @Value(&quot;${jdbc.password}&quot;)
    private String password;

     /**
     * 数据源连接池
     */
    @Bean
    public DataSource dataSource() throws PropertyVetoException {
        ComboPooledDataSource comboPooledDataSource = new ComboPooledDataSource();
        comboPooledDataSource.setDriverClass(driver);
        comboPooledDataSource.setJdbcUrl(url);
        comboPooledDataSource.setUser(userName);
        comboPooledDataSource.setPassword(password);
        return comboPooledDataSource;
    }

     /**
     * Spring JbdcTemplate
     */
    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
</code></pre>

<p>执行测试：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15), BaseBean(id=3, name=test, age=15)
</code></pre>

<p><strong>使用XML配置C3P0</strong></p>

<p>依旧使用application.xml，将数据源改为c3p0</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 导入数据库资源文件 --&gt;
    &lt;context:property-placeholder location=&quot;classpath:datasource.properties&quot;/&gt;
    &lt;!--配置数据源DBCP--&gt;
    &lt;bean class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; id=&quot;dataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置数据源C3P0--&gt;
    &lt;bean class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; id=&quot;dataSourceC3P0&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置注入数据源c3p0--&gt;
    &lt;bean id = &quot;baseDaoParent&quot; class=&quot;com.my.spring.dao.BaseDaoParent&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSourceC3P0&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;baseDao&quot; class=&quot;com.my.spring.dao.BaseDao&quot; parent=&quot;baseDaoParent&quot;&gt;&lt;/bean&gt;

    &lt;bean id=&quot;baseService&quot; class=&quot;com.my.spring.service.impl.BaseServiceImpl&quot;&gt;
        &lt;property name=&quot;baseDao&quot; ref=&quot;baseDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<p>将全局配置调整至读取xml模式，测试结果：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15), BaseBean(id=3, name=test, age=15), BaseBean(id=4, name=test, age=15)]
</code></pre>

<p><strong>BoneCP连接池</strong></p>

<p>一个快速，开源的数据库连接池。帮你管理数据连接让你的应用程序能更快速地访问数据库。比C3P0和DBCP快25倍</p>

<p>BoneCP依赖于<strong>com.jolbox.bonecp.BoneCPDataSource</strong> 类，其主要属性如下：
<strong>driveClass</strong>：<strong>数据库驱动</strong>
<strong>jdbcUrl</strong>：<strong>响应驱动的jdbcUrl</strong>
<strong>username</strong>：<strong>数据库的用户名</strong>
<strong>password</strong>：<strong>数据库的密码</strong></p>

<p><strong>使用注解实现BoneCP配置</strong></p>

<p>①引入依赖包</p>

<pre><code class="language-xml">&lt;!--引入BoneCP支持--&gt;
&lt;!-- https://mvnrepository.com/artifact/com.jolbox/bonecp --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.jolbox&lt;/groupId&gt;
    &lt;artifactId&gt;bonecp&lt;/artifactId&gt;
    &lt;version&gt;0.8.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;${org.springframework.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<p>②创建配置类：</p>

<pre><code class="language-java">@Configuration
@PropertySource(value = {&quot;classpath:datasource.properties&quot;})//引入资源文件
public class DataSourceConfig {

    @Value(&quot;${jdbc.driver}&quot;)
    private String driver;

    @Value(&quot;${jdbc.url}&quot;)
    private String url;

    @Value(&quot;${jdbc.username}&quot;)
    private String userName;

    @Value(&quot;${jdbc.password}&quot;)
    private String password;

     /**
     * 数据源连接池
     */
    @Bean
    public DataSource dataSource(){
        BoneCPDataSource boneCPDataSource = new BoneCPDataSource();
        boneCPDataSource.setDriverClass(driver);
        boneCPDataSource.setJdbcUrl(url);
        boneCPDataSource.setUser(userName);
        boneCPDataSource.setPassword(password);
        return boneCPDataSource;
    }

     /**
     * Spring JbdcTemplate
     */
    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
</code></pre>

<p>③测试结果：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15), BaseBean(id=3, name=test, age=15), BaseBean(id=4, name=test, age=15), BaseBean(id=5, name=test, age=15)]
</code></pre>

<p><strong>使用XML实现BoneCP配置</strong></p>

<p>依旧使用application.xml，将数据源改为BoneCP</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 导入数据库资源文件 --&gt;
    &lt;context:property-placeholder location=&quot;classpath:datasource.properties&quot;/&gt;
    &lt;!--配置数据源DBCP--&gt;
    &lt;bean class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; id=&quot;dataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置数据源C3P0--&gt;
    &lt;bean class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; id=&quot;dataSourceC3P0&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

     &lt;!--配置数据源BoneCP--&gt;
    &lt;bean class=&quot;com.jolbox.bonecp.BoneCPDataSource&quot; id=&quot;dataSourceBoneCP&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置注入数据源BonCP--&gt;
    &lt;bean id = &quot;baseDaoParent&quot; class=&quot;com.my.spring.dao.BaseDaoParent&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSourceBoneCP&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;baseDao&quot; class=&quot;com.my.spring.dao.BaseDao&quot; parent=&quot;baseDaoParent&quot;&gt;&lt;/bean&gt;

    &lt;bean id=&quot;baseService&quot; class=&quot;com.my.spring.service.impl.BaseServiceImpl&quot;&gt;
        &lt;property name=&quot;baseDao&quot; ref=&quot;baseDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<p>测试结果：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15), BaseBean(id=3, name=test, age=15), BaseBean(id=4, name=test, age=15), BaseBean(id=5, name=test, age=15), BaseBean(id=6, name=test, age=15)]
</code></pre>

<p><strong>Druid连接池</strong></p>

<p>阿里巴巴开源平台上一个数据库连接池实现，它结合了C3P0、DBCP、PROXOOL等DB池的优点，同时加入了日志监控，可以很好的监控DB池连接和SQL的执行情况，可以说是针对监控而生的DB连接池</p>

<p>Druid依赖于<strong>com.alibaba.druid.pool.DruidDataSource</strong> 实现，其主要属性如下：</p>

<p><strong>name</strong>:配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。 如果没有配置，将会生成一个名字，格式是：&rdquo;DataSource-&rdquo; + System.identityHashCode(this)</p>

<p><strong>driverClassName</strong>:这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName(建议配置下)
<strong>jdbcUrl</strong>:连接数据库的url，不同数据库不一样。
            例如： mysql&mdash;&mdash;- jdbc:mysql://10.20.153.104:3306/druid2
 oracle &mdash;&ndash;jdbc:oracle:thin:@10.20.149.85:1521:ocnauto
<strong>username</strong>:连接数据库的用户名
<strong>password</strong>:连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用ConfigFilter。</p>

<p><strong>使用注解实现Druid配置</strong></p>

<p>引入支持依赖</p>

<pre><code class="language-xml">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.1.10&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;${org.springframework.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<p>②创建配置类</p>

<pre><code class="language-java">@Configuration
@PropertySource(value = {&quot;classpath:datasource.properties&quot;})//引入资源文件
public class DataSourceConfig {

    @Value(&quot;${jdbc.driver}&quot;)
    private String driver;

    @Value(&quot;${jdbc.url}&quot;)
    private String url;

    @Value(&quot;${jdbc.username}&quot;)
    private String userName;

    @Value(&quot;${jdbc.password}&quot;)
    private String password;

     /**
     * 数据源连接池
     */
    @Bean
    public DataSource dataSource(){
        DruidDataSource druidDataSource = new DruidDataSource();
        druidDataSource.setDriverClassName(driver);
        druidDataSource.setUrl(url);
        druidDataSource.setUsername(userName);
        druidDataSource.setPassword(password);
        return druidDataSource;
    }

     /**
     * Spring JbdcTemplate
     */
    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
</code></pre>

<p>测试结果：</p>

<pre><code class="language-json">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15), BaseBean(id=3, name=test, age=15), BaseBean(id=4, name=test, age=15), BaseBean(id=5, name=test, age=15), BaseBean(id=6, name=test, age=15), BaseBean(id=7, name=test, age=15)]
</code></pre>

<p><strong>使用XML实现Druid配置</strong></p>

<p>使用application.xml</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 导入数据库资源文件 --&gt;
    &lt;context:property-placeholder location=&quot;classpath:datasource.properties&quot;/&gt;
    &lt;!--配置数据源DBCP--&gt;
    &lt;bean class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; id=&quot;dataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置数据源C3P0--&gt;
    &lt;bean class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; id=&quot;dataSourceC3P0&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

     &lt;!--配置数据源BoneCP--&gt;
    &lt;bean class=&quot;com.jolbox.bonecp.BoneCPDataSource&quot; id=&quot;dataSourceBoneCP&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置数据源Druid--&gt;
    &lt;bean class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; id=&quot;dataSourceDruid&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置注入数据源Druid--&gt;
    &lt;bean id = &quot;baseDaoParent&quot; class=&quot;com.my.spring.dao.BaseDaoParent&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSourceDruid&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;baseDao&quot; class=&quot;com.my.spring.dao.BaseDao&quot; parent=&quot;baseDaoParent&quot;&gt;&lt;/bean&gt;

    &lt;bean id=&quot;baseService&quot; class=&quot;com.my.spring.service.impl.BaseServiceImpl&quot;&gt;
        &lt;property name=&quot;baseDao&quot; ref=&quot;baseDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<p>测试结果：</p>

<pre><code class="language-properties">[BaseBean(id=1, name=test, age=15), BaseBean(id=2, name=test, age=15), BaseBean(id=3, name=test, age=15), BaseBean(id=4, name=test, age=15), BaseBean(id=5, name=test, age=15), BaseBean(id=6, name=test, age=15), BaseBean(id=7, name=test, age=15), BaseBean(id=8, name=test, age=15)]
</code></pre>

<h2 id="四-spring-数据库操作"><strong>四、Spring+数据库操作</strong></h2>

<p>如同往常我们想要实现一个简单的数据库操作，可能都会需要需要编写很多不必要的重复性代码，比如打开数据库，连接数据库，关闭数据库等，Spring JDBC使用JdbcTemplate封装重复操作</p>

<p>上述代码已经展示了简单的JdbcTemplate操作。实际上我们有几种可能的方式去使用JdbcTemplate带给我们的便利</p>

<h3 id="ⅰ-继承jdbcdaosupport类">Ⅰ、继承JdbcDaoSupport类</h3>

<p>如同上述代码中所使用的例子：</p>

<pre><code class="language-java">@Component
public class BaseDaoParent extends JdbcDaoSupport {

    //注入DataSource
    @Autowired
    private DataSource dataSource;

    //因为JdbcDaoSupport的setDataSource方法是final修饰的，@Autowired注入失败，所以必须手动注入
    @PostConstruct
    private void initialize(){
        setDataSource(dataSource);
    }
}

@Repository
public class BaseDao extends BaseDaoParent{

    /**
     * 保存一个记录
     * @param baseBean
     */
    public void save(BaseBean baseBean){
        this.getJdbcTemplate().update(&quot;insert into basebean(name,age) values ('&quot;+baseBean.getName()+&quot;',&quot;+baseBean.getAge()+&quot;)&quot;);
    }

    /**
     * 获取所有bean记录
     * @return
     */
    public List&lt;BaseBean&gt; findAll(){
        RowMapper&lt;BaseBean&gt; rowMapper = new BeanPropertyRowMapper&lt;&gt;(BaseBean.class);
        return this.getJdbcTemplate().query(&quot;select * from basebean&quot;,rowMapper);
    }
}
</code></pre>

<p>可以看到这种方式的限制是DataSource的注入过于繁琐，所以一般不使用这种方式</p>

<h3 id="ⅱ-直接引用jdbctemplate">Ⅱ、直接引用JdbcTemplate</h3>

<p>实际上，上述代码中的this.getJdbcTemplate()得到的也是上下文中的JdbcTemplate对象，我们可以选择直接注入JdbcTemplate进行使用，效果一样：</p>

<pre><code class="language-java">@Repository
public class BaseDao{

    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 保存一个记录
     * @param baseBean
     */
    public void save(BaseBean baseBean){
        this.jdbcTemplate.update(&quot;insert into basebean(name,age) values ('&quot;+baseBean.getName()+&quot;',&quot;+baseBean.getAge()+&quot;)&quot;);
    }

    /**
     * 获取所有bean记录
     * @return
     */
    public List&lt;BaseBean&gt; findAll(){
        RowMapper&lt;BaseBean&gt; rowMapper = new BeanPropertyRowMapper&lt;&gt;(BaseBean.class);
        return this.jdbcTemplate.query(&quot;select * from basebean&quot;,rowMapper);
    }
}
</code></pre>

<p>这种做法的限制是应用代码与Spring JdbcTemplate的耦合性增强</p>

<h3 id="ⅲ-使用jdbcoperations类">Ⅲ、使用JdbcOperations类</h3>

<p>JdbcOperations 是一个接口，定义了 JdbcTemplate 所实现的操作。通过注入 JdbcOperations ，而不是具体的 JdbcTemplate ，能够保证dao 通过 JdbcOperations 接口达到与 JdbcTemplate 保持松耦合</p>

<pre><code class="language-java">@Repository
public class BaseDao{

    @Autowired
    private JdbcOperations jdbcOperations;

    /**
     * 保存一个记录
     * @param baseBean
     */
    public void save(BaseBean baseBean){
        this.jdbcOperations.update(&quot;insert into basebean(name,age) values ('&quot;+baseBean.getName()+&quot;',&quot;+baseBean.getAge()+&quot;)&quot;);
    }

    /**
     * 获取所有bean记录
     * @return
     */
    public List&lt;BaseBean&gt; findAll(){
        RowMapper&lt;BaseBean&gt; rowMapper = new BeanPropertyRowMapper&lt;&gt;(BaseBean.class);
        return this.jdbcOperations.query(&quot;select * from basebean&quot;,rowMapper);
    }
}
</code></pre>

<h2 id="五-spring与jdbctemplate"><strong>五、Spring与JdbcTemplate</strong></h2>

<p>实际上，<strong>JdbcTemplate</strong>所能做的远不止上述代码所展示。Spring中，有如下三种<strong>JdbcTemplate：</strong></p>

<ul>
<li><strong>JdbcTemplate</strong> <strong>：最基本的 Spring JDBC 模板，这个模板支持简单的 JDBC 数据库访问功能以及基于索引参数的查询；</strong></li>
<li><strong>NamedParameterJdbcTemplate</strong> <strong>：使用该模板类执行查询时可以将值以命名参数的形式绑定到 SQL 中，而不是使用简单的索引参</strong></li>
<li>数；</li>
<li><strong>SimpleJdbcTemplate</strong> <strong>：该模板类利用 Java 5 的一些特性如自动装箱、泛型以及可变参数列表来简化 JDBC 模板的使用。</strong></li>
</ul>

<p>我们采用最合适的jdbcOperations来学习<strong>JdbcTemplate</strong>的功能</p>

<p><strong>JdbcTemplate主要提供以下五类方法：</strong></p>

<ul>
<li><strong>execute</strong>方法：可以用于执行任何<strong>SQL</strong>语句，一般用于执行<strong>DDL</strong>语句</li>
<li><strong>update</strong>方法及<strong>batchUpdate</strong>方法：<strong>update</strong>方法用于执行新增、修改、删除等语句；<strong>batchUpdate</strong>方法用于执行批处理相关语句**</li>
<li><strong>query</strong>方法及<strong>queryForXXX</strong>方法：用于执行查询相关语句</li>
<li><strong>call</strong>方法：用于执行存储过程、函数相关语句</li>
</ul>

<p>其中较为常用的有以下方法：</p>

<p>①<strong><T> T queryForObject(String sql, RowMapper<T> rowMapper, @Nullable Object&hellip; args) throws DataAccessException</strong></p>

<p>根据语句和传参查询某个记录并将结果封装成对象</p>

<pre><code class="language-java">private final static String FIND_BASE_BEAN = &quot;select * from basebean where id=?&quot;;
public BaseBean findOne(Integer id){
    //目标对象映射
    RowMapper&lt;BaseBean&gt; rowMapper = new BeanPropertyRowMapper&lt;&gt;(BaseBean.class);
    //执行查询并返回目标对象
    return this.jdbcOperations.queryForObject(FIND_BASE_BEAN,rowMapper,id);
}
</code></pre>

<p>②<strong>int update(String sql, @Nullable Object&hellip; args) throws DataAccessException;</strong></p>

<p>更新或插入数据</p>

<pre><code class="language-java">private final static String INSERT_BASE_BEAN = &quot;insert into basebean(name,age) values (?,?)&quot;;
public void save(BaseBean baseBean){
    this.jdbcOperations.update(INSERT_BASE_BEAN,baseBean.getName(),baseBean.getAge());
}
</code></pre>

<p>③<strong>int update(String sql, @Nullable PreparedStatementSetter pss) throws DataAccessException;</strong></p>

<p>使用预编译设置更新或插入数据</p>

<pre><code class="language-java">private final static String INSERT_BASE_BEAN = &quot;insert into basebean(name,age) values (?,?)&quot;;
int count = this.jdbcOperations.update(INSERT_BASE_BEAN, new PreparedStatementSetter() {  
      @Override  
      public void setValues(PreparedStatement pstmt) throws SQLException {  
          pstmt.setObject(1, baseBean.getName());  
          pstmt.setObject(2, baseBean.getAge());
}}); 
</code></pre>

<p>使用命名参数Template实现功能，与使用简单的JdbcTemplate几乎完全相同：</p>

<pre><code class="language-java">@Bean
public NamedParameterJdbcTemplate jdbcTemplate(DataSource dataSource) {
    return new NamedParameterJdbcTemplate(dataSource);
}
</code></pre>

<p>通过<strong>NamedParameterJdbcTemplate</strong>执行插入</p>

<pre><code class="language-java">//此处留下命名参数占位
private final static String INSERT_BASE_BEAN = &quot;insert into basebean(name,age) values (:name,:age)&quot;;

public void save(BaseBean baseBean){
    //封装命名参数值
    Map&lt;String,Object&gt; paramMap=new HashMap();
    paramMap.put(&quot;name&quot;,baseBean.getName()));
    paramMap.put(&quot;age&quot;, baseBean.getAge());

    this.jdbcOperations.update(INSERT_BASE_BEAN,paramMap);
}
</code></pre>

<h2 id="总结"><strong>总结</strong></h2>

<p>数据是应用程序的血液。</p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>GF.L </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://keep-zero.github.io/2019/spring_action10/>https://keep-zero.github.io/2019/spring_action10/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://keep-zero.github.io/tags/java/">
                    #java</a></span>
            
            <span class="tag"><a href="https://keep-zero.github.io/tags/spring/">
                    #spring</a></span>
            
            <span class="tag"><a href="https://keep-zero.github.io/tags/spring-action/">
                    #spring-action</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://keep-zero.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://keep-zero.github.io/2019/spring_action09/" class="prev" rel="prev" title="《Spring实战》-第九章:Spring Web应用安全（Spring Security）"><i class="iconfont icon-left"></i>&nbsp;《Spring实战》-第九章:Spring Web应用安全（Spring Security）</a>
         
        
        <a href="https://keep-zero.github.io/2019/spring_action11_01/" class="next" rel="next" title="《Spring实战》-第十一章：利用对象-关系映射持久化数据">《Spring实战》-第十一章：利用对象-关系映射持久化数据&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2011 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
        </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://keep-zero.github.io">GF.L</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
		<span id="busuanzi_container_site_pv">
			本站访问量：<span id="busuanzi_value_site_pv"></span>次
		</span>
		&nbsp;
		<span id="busuanzi_container_site_uv">
			您是本站第 <span id="busuanzi_value_site_uv"></span> 位访问者
		</span>
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
